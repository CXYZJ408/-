# 用户安全验证系统说明


## Access token 说明

Access token 用于给应用程序代表用户向后台发出API请求，此处使用了[JWT协议](https://www.jianshu.com/p/576dbf44b2ae)，在每一次访问API都必须携带，后台服务器通过验证Token所包含的数据来给予用户可以访问的数据，根据JWT协议中，Token私有的声明组成包含：

1. userId：用户的ID，表示当前token来自哪个用户授权
2. role: 用户权限，该token允许换取的用户受保护资源范围

## 前端

首先，当前端用户访问页面的时候，先判断本地是否有token，如果没有则默认使用自带的匿名token，然后在前端访问后台api时，axios会拦截相应的请求，将当前的token加入到响应头当中。

## 后端

后端对于前端进行的所有api访问均需要进行验证，具体使用spring security框架进行权限控制。

## Token获取

获取token的方式有两种，一种是在不登录的前提下，前端默认使用自带的匿名token，该token访问的内容是有一定限制的，在进行发表文章，讨论，评论等操作时都会被拒绝；另一种是登陆后，后端根据该用户的个人信息颁发的私人token，该token可以访问在其权限内可以访问的所有api。

## Token过期刷新

因为除了匿名Token以外的token都会有过期时间（匿名也有，只不过设置的时间比较长，在可预测的时间范围内不会过期），一般为2小时，所以在过期后需要进行刷新操作，因为服务器在用户登录后，除了会给一个token用于后台数据访问外，还会给一个refresh token用于token的刷新操作使用，所以当前端发送给后端的token经验证发现过期后，前端使用refresh token来进行token的刷新操作，获取一个新的token，当然refresh token也是有有效期的，一般为30天，而且不可刷新，一旦到期就需要用户重新登录。
